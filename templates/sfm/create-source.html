{% extends "base.html" %}
{% load staticfiles %}
{% load viewcomplexfield %}
{% load i18n %}
{% block extra_head %}
  <link rel="stylesheet" href="{% static "css/select2.min.css" %}">
  <script src="{% static "js/select2.min.js" %}"></script>

{% endblock %}
{% block content %}
<div class="row">
    <form method="post">
        {% csrf_token %}
        {% if form.title.errors %}
            <div class="form-group has-error has-feedback">
        {% else %}
            <div class="form-group">
        {% endif %}
            <label for="id_title" class="col-sm-2 control-label">Source title</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="id_title" name="title">
            {% if form.title.errors %}
                {% for error in form.title.errors %}
                <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                {% endfor %}
            {% endif %}
            </div>
        </div>
        {% if form.publication_name.errors or form.publication_country.errors %}
            <div class="form-group has-error has-feedback">
        {% else %}
            <div class="form-group">
        {% endif %}
            <label for="id_publication_name" class="col-sm-2 control-label">Publication</label>
            <div class="col-sm-5">
                <select id="id_publication_name" name="publication_name">
                    <option value="None" selected=true>---------</option>
                </select>
            {% if form.publication_name.errors %}
                {% for error in form.publication_name.errors %}
                <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                {% endfor %}
            {% endif %}
            </div>
            <div class="col-sm-5">
                <input type="text" class="form-control" id="id_publication_country" name="publication_country" placeholder="Country">
            {% if form.publication_country.errors %}
                {% for error in form.publication_country.errors %}
                <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                {% endfor %}
            {% endif %}
            </div>
        </div>
        <div class="form-group">
            <div class='col-sm-10 col-sm-offset-2'>
                <input class="btn btn-default" type="submit" value="Submit" />
            </div>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">
    $(document).ready(function(e){
        $('#id_publication_name').select2({
            ajax: {
                url: "{% url 'publications-autocomplete' %}",
                datType: 'json',
                delay: 250,
                data: function(params){
                    console.log(params);
                    return {
                        q: params.term,
                        page: params.page
                    };
                },
                processResults: function(data, params){
                    params.page = params.page || 1;
                    return {
                        results: data.items,
                        pagination: {
                            more: (params.page * 30) < data.total_count
                        }
                    }
                },
                cache: true
            },
            escapeMarkup: function(markup){ return markup; },
            minimumInputLength: 2,
            templateResult: function(data){
                console.log('result', data);
                return '<p>Hi! result</p>';
            },
            templateSelection: function(data){
                console.log('selection', data);
                return '<p>Hi! selection</p>'
            }
        });
    })
</script>
{% endblock %}
