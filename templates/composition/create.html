{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}
{% load get_item %}
{% block extra_head %}
  <link rel="stylesheet" href="{% static "css/select2.min.css" %}">
  <style>
    .dynamic-form { margin: 10px 0; }
  </style>
{% endblock %}
{% block content %}
{% include 'partials/nav-wizard.html' %}
<div class="row">
    <h2>Organization relationships</h2>
    <p>Describe the relationships between organizations found in <strong>{{ source.title }}</strong> ({{source.publication.title}}, {{ source.published_on|date:"F d, Y"}})</p>
    <hr />
</div>
<div class="row">
    <form method="post" action="" id="org-form" class="form-horizontal">
        {% csrf_token %}
        {{ formset.management_form }}
        <div id="dynamic-form">
            {% if formset.errors %}
                {% for form in formset %}
                    {% with form_id=forloop.counter0 %}
                        <div id="form-{{ form_id }}-wrapper">
                        {% if form.relationship_type.errors %}
                            <div class="form-group has-error has-feedback">
                        {% else %}
                            <div class="form-group">
                        {% endif %}
                                <label class="col-sm-2 control-label">Relationship type</label>
                                <div class="col-sm-8">
                                    <select id="id_form-{{ form_id }}-relationship_type" class="form-control" name="form-{{ form_id }}-relationship_type">
                                        {% for type in relationship_types %}
                                            {% if form.cleaned_data.relationship_type == type %}
                                                <option value="{{ type.0 }}" selected=true>{{ type.1 }}</option>
                                            {% else %}
                                                <option value="{{ type.0 }}">{{ type.1 }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    {% if form.relationship_type.errors %}
                                        {% for error in form.relationship_type.errors %}
                                        <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        {% if form.related_organization.errors %}
                            <div class="form-group has-error has-feedback">
                        {% else %}
                            <div class="form-group">
                        {% endif %}
                                <label class="col-sm-2 control-label">Related organization</label>
                                <div class="col-sm-8">
                                    <select id="id_form-{{ form_id }}-related_organization" class="form-control organization-field" name="form-{{ form_id }}-related_organization">
                                            <option value="" selected="selected">--------</option>
                                        {% if form.cleaned_data.related_organization %}
                                            <option value="{{ form.cleaned_data.related_organization }}" selected=true>{{ form.cleaned_data.related_organization }}</option>
                                        {% endif %}
                                    </select>
                                    {% if form.related_organization.errors %}
                                        {% for error in form.related_organization.errors %}
                                        <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        {% if form.classification.errors %}
                            <div class="form-group has-error has-feedback">
                        {% else %}
                            <div class="form-group">
                        {% endif %}
                                <label class="col-sm-2 control-label">Relationship classification</label>
                                <div class="col-sm-8">
                                    <select id="id_form-{{ form_id }}-classification" class="form-control classification-field" name="form-{{ form_id }}-classification">
                                            <option value="" selected="selected">--------</option>
                                        {% if form.cleaned_data.classification %}
                                            <option value="{{ form.cleaned_data.classification }}" selected=true>{{ form.cleaned_data.classification }}</option>
                                        {% endif %}
                                    </select>
                                    {% if form.classification.errors %}
                                        {% for error in form.classification.errors %}
                                        <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        {% if form.startdate.errors or form.enddate.errors %}
                            <div class="form-group has-error has-feedback">
                        {% else %}
                            <div class="form-group">
                        {% endif %}
                                <label class="control-label col-sm-2" for="id_form-{{ form_id }}-startdate">Start & end dates</label>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control datepicker" id="id_form-{{ form_id }}-startdate" name="form-{{ form_id }}-startdate" value="{{ form.cleaned_data.startdate|date:'Y-m-d' }}"/>
                                    {% if form.startdate.errors %}
                                        {% for error in form.startdate.errors %}
                                        <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control datepicker" id="id_form-{{ form_id }}-enddate" name="form-{{ form_id }}-enddate" value="{{ form.cleaned_data.enddate|date:'Y-m-d' }}"/>
                                    {% if form.enddate.errors %}
                                        {% for error in form.enddate.errors %}
                                        <span class="help-block"><i class="fa fa-remove"> </i> {{error}}</span>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endwith %}
                {% endfor %}
            {% endif %}
        </div>
        <div class="row">
            <div class="form-group">
                <div class="col-md-12">
                    <button type="submit" class="pull-right btn sfm-btn-action" value="Submit">Continue</button>
                    <a class="btn btn-default" href="{% url 'create-person' %}">Skip</a>
                </div>
            </div>
        </div>
    </form>
</div>

{% endblock %}
